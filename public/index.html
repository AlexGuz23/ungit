<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0 ">
    <link rel="stylesheet/css" type="text/css" href="/styles/normalize.css" />
	<link rel="stylesheet" href="/styles/animate.css"/>
	<link rel="stylesheet/less" type="text/css" href="/styles/styles.less" />
	<title>ungit</title>
</head>
<body>

<script type="text/html" id="home">
	<div class='home'>
		<img src="images/logoLarge.png" class="logo">
		<div>
		<div class="repos">
			<div class="title">Recent repositories</div>
			<div data-bind="foreach: repos">
				<a class="repo" data-bind="text: title, attr: { href: link }"></a>
			</div>
		</div>
		</div>
	</div>
</script>

<script type="text/html" id="crash">
	<div class='crash'>
		<div class='box'>
			<h1>Whooops</h1>
			Something went wrong, reload the page to start over.
		</div>
	</div>
</script>

<script type="text/html" id="usererror">
	<div class='crash'>
		<div class='box'>
			<h1 data-bind="text: title"></h1>
			<span data-bind="text: details"></span>
		</div>
	</div>
</script>

<script type="text/html" id="path">
	<div class="path">

		<div class='animated fadeInLeft' data-bind="visible: status() == 'loading'">
			Loading...
		</div>

		<div class='animated fadeInLeft' data-bind="visible: status() == 'cloning'">
			Cloning repository...
		</div>
		
		<div class="uninited" data-bind="visible: status() == 'uninited'">
			<div class="topic">"<span data-bind="text: path"></span>" is not a repository.</div>
			<button class="initRepository" data-bind='click: initRepository'>Initialize a repository here!</button>
			<div class="or"><div class="line"></div>or<div class="line"></div></div>
			<form class="cloneRepository" data-bind="submit: cloneRepository">
				<div>Clone from</div>
				<div><input type="text" placeholder="url" data-bind="value: cloneUrl, valueUpdate: 'afterkeydown'"></div>
				<div>to</div>
				<div><input type="text" data-bind="value: cloneDestination, attr: { placeholder: cloneDestinationImplicit }"></div>
				<div><input type="submit" value="Clone repository!"></div>
			</form>
		</div>

		<div class="invalidpath" data-bind="visible: status() == 'invalidpath'">
			<div>"<span data-bind="text: path"></span>" is not a valid path.</div>
		</div>

		<!-- ko if: repository -->
		<div data-bind="template: { name: 'repository', data: repository }">
		</div>
		<!-- /ko -->

	</div>
</script>


<script type="text/html" id="staging">
	<div class="staging" data-bind="css: { commitValidationError: commitValidationError }">
		<div class="arrowContainer arrowDown">
			<img src="images/shadowArrowDown.png" class="shadow">
			<img src="images/yellowArrowDown.png" class="arrow">
		</div>
		<div data-bind="visible: !isCommitting()">
			<table><tr><td class="commitArea">
				<div class="commitMessage">
				<input class="title" type="text" placeholder="Title (required)" data-bind="value: commitMessageTitle, valueUpdate: 'afterkeydown'">
				<textarea class="body" placeholder="Body" data-bind="value: commitMessageBody, valueUpdate: 'afterkeydown'"></textarea>
				</div>
				<div class="stats"><span data-bind="text: stats"></span> - <a href="#" data-bind="click: discardAllChanges">Discard all</a></div>
				<div class="files" data-bind="foreach: files">
					<div class="file" data-bind="css: { showingDiffs: showingDiffs }">
						<img src="images/whiteArrowLeftWithBorder.png" class="arrowLeft" data-bind="visible: showingDiffs">
						<div class="checkbox" data-bind="click: toogleStaged, css: { checked: staged }"></div>
						<span class="name" data-bind="text: name, click: toogleDiffs"></span>
						<span class="new" data-bind="visible: isNew">New</span>
						<span class="deleted" data-bind="visible: removed">Removed</span>
						<span class="discard" data-bind="click: discardChanges">&#x2716;<span class="explanation"> discard changes</span></span>
					</div>
				</div>
				<button class="commitButton" data-bind="click: commit, enable: !commitValidationError()">Commit</button>
				<span class="amend">
					<div class="checkbox" data-bind="click: toogleAmend, css: { checked: amend }"></div>
					Amend last commit
				</span>
				<span class="validationError" data-bind="text: commitValidationError, visible: commitValidationError"></span>
			</td><td class="diffArea" data-bind="css: { noFileSelected: !selectedDiffFile() }">
				<!-- ko if: selectedDiffFile -->
					<div data-bind="template: { name: 'fileDiff', data: selectedDiffFile().diffs }"></div>
				<!-- /ko -->
				<!-- ko if: !selectedDiffFile() -->
				Click a file to show its changes
				<!-- /ko -->
			</td></tr></table>
		</div>
		<div class="committing" data-bind="visible: isCommitting">
			<div>Committing changes...</div>
			<div class="throbber"></div>
		</div>
	</div>
</script>

<script type="text/html" id="fileDiff">
	<table class="fileDiff" data-bind="foreach: $data">
		<tr data-bind="css: { added: added, removed: removed }">
			<td class="lineNumbers old">
				<span class="lineNumber" data-bind="text: oldLineNumber"></span>&nbsp;
			</td>
			<td class="lineNumbers new">
				<span class="lineNumber" data-bind="text: newLineNumber"></span>&nbsp;
			</td>
			<td class="diffs">
				<span class="diff" data-bind="text: text, css: { added: added, removed: removed }"></span>&nbsp;
			</td>
		</tr>
	</table>
</script>

<script type="text/html" id="repository">
	<div class="repository">

		<div class='animated fadeInLeft' data-bind="visible: status() == 'loading'">
			Loading...
		</div>
		
		<div class="inited animated fadeInLeft" data-bind="visible: status() == 'inited'">

			<!-- ko if: gerritIntegration -->
			<div data-bind="template: { name: 'gerritIntegration', data: gerritIntegration }"></div>
			<!-- /ko -->

			<div class="repositoryMain">

				<!-- ko template: { name: 'staging', data: staging } --><!-- /ko -->
				
				<!-- ko if: showGerritIntegrationButton -->
				<div class="enableGerritIntegration">
					<button data-bind="click: toogleGerritIntegration">Enable gerrit integration</button>
				</div>
				<!-- /ko -->

				<div class="graphUtils" data-bind="visible: isFetching">
					<img src="images/grayArrowDown.png" class="arrowDown">
					<div class="fetchingIndicator">Fetching nodes from remote...</div>
				</div>
				
				<div class="graph" data-bind="with: graph">

					<div class="daySeparators" data-bind="foreach: daySeparators">
						<div class="daySeparator" data-bind="style: { left: x + 'px', top: y + 'px' }">
							<img src="images/whiteArrowRight.png" class="arrowRight">
							<div class="dateLabel" data-bind="text: date"></div>
						</div>
					</div>

					<div class="graphLog" data-bind="graphLog: $data">
					</div>
					
					<div class="nodes" data-bind="foreach: nodes">
						<div class="node" data-bind="style: { left: boxDisplayX() + 'px', top: boxDisplayY() + 'px' }">
							<div class="log" data-bind="visible: logBoxVisible">
								<div class="logEntryBox">
									<div class="arrowContainer arrowRight">
										<img src="images/shadowArrowRight.png" class="shadow">
										<img src="images/whiteArrowRight.png" class="arrow">
									</div>
									<div class="title" data-bind="text: title"></div>
									<div class="date" data-bind="text: authorDate"></div>
									<a class="author" data-bind="text: authorName, attr: { href: 'mailto:' + authorEmail }"></a>
								</div>
							</div>

							<div class="refs">
								<!-- ko foreach: branches -->
								<div class="refbox branch" data-bind="css: { current: current, remote: isRemoteBranch }, dragStart: dragStart, dragEnd: dragEnd" draggable="true">
									<img src="images/grayArrowLeft.png" class="arrowLeft" data-bind="visible: $index() == 0">
									<span class="refType" data-bind="visible: isRemoteBranch">remote branch: </span>
									<span class="refType" data-bind="visible: isLocalBranch">local branch: </span>
									<div class="name" data-bind="text: displayName"></div>
								</div>
								<!-- ko if: current -->
								<!-- ko foreach: graphActions -->
								<div class="refbox graphAction" data-bind="click: perform, visible: visible, event: { mouseover: mouseover, mouseout: mouseout }, css: style">
									<span data-bind="text: icon"></span>
									<span class="tooltip" data-bind="text: tooltip"></span>
								</div>
								<!-- /ko -->
								<!-- /ko -->
								<!-- /ko -->

								<!-- ko foreach: tags -->
								<div class="refbox tag" data-bind="css: { current: current, remote: isRemoteTag }, dragStart: dragStart, dragEnd: dragEnd" draggable="true">
									<img src="images/grayArrowLeft.png" class="arrowLeft" data-bind="visible: $index() == 0 && $parent.branches().length == 0">
									<span class="refType" data-bind="visible: isRemote">remote tag: </span>
									<span class="refType" data-bind="visible: isLocal">local tag: </span>
									<div class="name" data-bind="text: displayName"></div>
								</div>
								<!-- /ko -->

								<div class="refbox newRef" data-bind="css: { editing: branchingFormVisible }">
									<img src="images/grayArrowLeft.png" class="arrowLeft" data-bind="visible: branches().length == 0 && tags().length == 0">
									<button class="showBranchingForm" data-bind="click: showBranchingForm, visible: !branchingFormVisible()">&#x271A;</button>
									<!-- ko if: branchingFormVisible -->
									<form data-bind="submit: createBranch">
										<input class="name" type="text" autofocus="true" data-bind="value: newBranchName, hasfocus: newBranchNameHasFocus">
										<input class="submit primaryAction" type="submit" value="Branch">
										<button class="submit" data-bind="click: createTag">Tag</button>
									</form>
									<!-- /ko -->
								</div>

								<div class="refbox move droparea" data-bind="dropOver: true, drop: dropMoveRef, css: { show: showDropTargets }">
								</div>

							</div>

						</div>
					</div>

				</div>

			</div>

		</div>
		
		<!-- ko with: graph -->
		<div class="refDropActions" data-bind="css: { active: showRefDropActions }">
			<div class="throbber" data-bind="visible: refDropActionsWorking"></div>
			<div data-bind="visible: !refDropActionsWorking()">
				<div class="droparea push" data-bind="dropOver: true, drop: dropPushRef, visible: draggingRef() && draggingRef().canBePushed">Push</div>
				<div class="droparea checkout" data-bind="dropOver: true, drop: dropCheckoutRef">Checkout</div>
				<div class="droparea delete" data-bind="dropOver: true, drop: dropDeleteRef">Delete</div>
			</div>
		</div>
		<!-- /ko -->

	</div>
</script>

<script type="text/html" id="gerritIntegration">
	<div class="gerritIntegration">
		<h1>Gerrit</h1>

		<button data-bind="visible: showInitCommmitHook, click: initCommitHook, text: initCommitHookMessage"></button>

		<div><button data-bind="click: pushForReview">Push changes for review</button></div>

		<div class="changes">
			<div class="throbber" data-bind="visible: loadingChanges"></div>
			<div data-bind="visible: !loadingChanges()" class="animated fadeInLeft">
				<div data-bind="foreach: changes">
					<div class="change">
						<span class="subject" data-bind="text: subject"></span> by <span class="owner" data-bind="text: ownerName"></span>
						<div>
							<button class="checkout" data-bind="click: checkout">Checkout</button>
							<button class="openInGerrit" data-bind="click: openInGerrit">Open in gerrit</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>

<script type="text/html" id="alertDialog">
	<div class="alertDialog">
		<div class="status" data-bind="text: message"></div>
		<button data-bind="click: close">Ok</button>
	</div>
</script>

<script type="text/html" id="pushDialog">
	<div class="pushDialog">
		<div class="status">Pushing changes to remote...</div>
		<form data-bind="submit: submitCredentials, visible: showCredentialsForm">
		<div>Remote requires authentication</div>
		<div>Username: <input type="text" data-bind="value: username" autofocus></div>
		<div>Password: <input type="password" data-bind="value: password"></div>
		<div><input type="submit"></div>
		</form>
	</div>
</script>

<div class="main">

	<div class="header">
		
		<a class="logo" href="/#/"><img src="images/logo.png" class="logo"></a>

		<form class="currentDirectory" data-bind="submit: submitPath">
			<input type="text" data-bind="value: path">
		</form>
		<img src="images/lightGrayArrowUp.png" class="arrowUp">
	</div>

	<div class="content" data-bind="template: { name: templateChooser, data: content }"></div>

</div>

<!-- ko if: dialog -->
<div class="dialog animated fadeIn">
	<div class="modalContainer">
		<div class="modal" data-bind="template: { name: templateChooser, data: dialog }"></div>
	</div>
</div>
<!-- /ko -->

<script type="text/javascript" src="/config.js"></script>
<script src="http://www.bugsense.com/static/js/global/bugsense.js" type='text/javascript'></script>
<script type="text/javascript">
	if (config.bugtracking) {
		console.log('Initing bugtracking');
    	var bugsense = new Bugsense( { apiKey: '3c48046e' } );
    }
</script>
<script type="text/javascript" src="/scripts/lib/less-1.3.3.min.js"></script>
<script type='text/javascript' src='/scripts/lib/knockout-2.2.1.js'></script>
<script type="text/javascript" src="/scripts/lib/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="/scripts/lib/jquery.dnd_page_scroll.js"></script>
<script type="text/javascript" src="/scripts/lib/google.ui.fastbutton.js"></script>
<script type="text/javascript" src="/scripts/lib/superagent.js"></script>
<script type="text/javascript" src="/scripts/lib/signals.js"></script>
<script type="text/javascript" src="/scripts/lib/hasher.js"></script>
<script type="text/javascript" src="/scripts/lib/crossroads.js"></script>
<script type="text/javascript" src="/scripts/lib/uuid.js"></script>
<script type="text/javascript" src="/scripts/lib/moment.js"></script>
<script type="text/javascript" src="/scripts/lib/underscore.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type='text/javascript' src='/scripts/utils.js'></script>
<script type='text/javascript' src='/scripts/api.js'></script>
<script type='text/javascript' src='/scripts/gitGraph.js'></script>
<script type='text/javascript' src='/scripts/vector2.js'></script>
<script type='text/javascript' src='/scripts/logrenderer.js'></script>
<script type='text/javascript' src='/scripts/repository.js'></script>
<script type='text/javascript' src='/scripts/app.js'></script>
<script type='text/javascript' src='/scripts/main.js'></script>

</body>
</html>
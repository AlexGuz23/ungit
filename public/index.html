<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0 ">
    <link rel="stylesheet/css" type="text/css" href="/styles/normalize.css" />
	<link rel="stylesheet" href="/styles/animate.css"/>
	<link rel="stylesheet/less" type="text/css" href="/styles/styles.less" />
	<link rel="shortcut icon" href="/favicon.ico" >
	<title>ungit</title>
</head>
<body>

<script type="text/html" id="home">
	<div class='home'>
		<img src="images/logoLarge.png" class="logo">
		<div>
		<div class="repos">
			<div class="title">Recent repositories</div>
			<div data-bind="foreach: repos">
				<a class="repo" data-bind="text: title, attr: { href: link }"></a>
			</div>
		</div>
		</div>
	</div>
</script>

<script type="text/html" id="crash">
	<div class='crash'>
		<h1>Whooops</h1>
		Something went wrong, reload the page to start over.
	</div>
</script>

<script type="text/html" id="usererror">
	<div class='crash'>
		<h1 data-bind="text: title"></h1>
		<span data-bind="text: details"></span>
	</div>
</script>

<script type="text/html" id="login">

	<div data-bind="visible: status() == 'loading'">
	</div>

	<div class='login' data-bind="visible: status() == 'login'">
		<h1>Login</h1>
		<div class="loginError" data-bind="text: loginError"></div>
		<form data-bind="submit: login">
			<div>Username: <input type="text" data-bind="value: username"></div>
			<div>Password: <input type="password" data-bind="value: password"></div>
			<input type="submit" value="Login">
		</form>
	</div>
</script>


<script type="text/html" id="path">
	<div class="path" data-bind="shown: shown">

		<div class='animated fadeInLeft' data-bind="visible: status() == 'loading'">
			<!-- ko template: { name: 'progressBar', data: loadingProgressBar } --><!-- /ko -->
		</div>

		<div class='animated fadeInLeft' data-bind="visible: status() == 'cloning'">
			Cloning...
			<!-- ko template: { name: 'progressBar', data: cloningProgressBar } --><!-- /ko -->
		</div>
		
		<div class="uninited" data-bind="visible: status() == 'uninited'">
			<div class="topic">"<span data-bind="text: path"></span>" is not a repository.</div>
			<button class="initRepository" data-bind='click: initRepository'>Initialize a repository here!</button>
			<div class="or"><div class="line"></div>or<div class="line"></div></div>
			<form class="cloneRepository" data-bind="submit: cloneRepository">
				<div>Clone from</div>
				<div><input type="text" placeholder="url" data-bind="value: cloneUrl, valueUpdate: 'afterkeydown'"></div>
				<div>to</div>
				<div><input type="text" data-bind="value: cloneDestination, attr: { placeholder: cloneDestinationImplicit }"></div>
				<div><input type="submit" value="Clone repository!"></div>
			</form>
		</div>

		<div class="invalidpath" data-bind="visible: status() == 'invalidpath'">
			<div>"<span data-bind="text: path"></span>" is not a valid path.</div>
		</div>

		<!-- ko if: repository -->
		<div data-bind="template: { name: 'repository', data: repository }">
		</div>
		<!-- /ko -->

	</div>
</script>


<script type="text/html" id="staging">
	<div class="staging" data-bind="css: { commitValidationError: commitValidationError }">
		<div class="arrowContainer arrowDown">
			<img src="images/yellowArrowDown.png" class="arrow">
		</div>
		<div>
			<table><tr><td class="commitArea">
				<div class="commitMessage">
				<input class="title" type="text" placeholder="Title (required)" data-bind="value: commitMessageTitle, valueUpdate: 'afterkeydown', enable: !inRebase()">
				<textarea class="body" placeholder="Body" data-bind="value: commitMessageBody, valueUpdate: 'afterkeydown', enable: !inRebase()"></textarea>
				</div>
				<div class="stats"><span data-bind="text: stats"></span> - <a href="#" data-bind="click: discardAllChanges">Discard all</a></div>
				<div class="files" data-bind="foreach: files">
					<div class="file" data-bind="css: { showingDiffs: showingDiffs }">
						<img src="images/whiteArrowLeftWithBorder.png" class="arrowLeft" data-bind="visible: showingDiffs">
						<div class="checkbox" data-bind="click: toogleStaged, css: { checked: staged }"></div>
						<span class="name" data-bind="text: name, click: toogleDiffs"></span>
						<span class="new" data-bind="visible: isNew">New</span>
						<span class="deleted" data-bind="visible: removed">Removed</span>
						<span class="conflict" data-bind="visible: conflict, click: resolveConflict"><span class="explanation">Resolve&nbsp;</span>Conflict</span>
						<span class="discard" data-bind="click: discardChanges">&#x2716;<span class="explanation"> discard changes</span></span>
					</div>
				</div>
				<button class="commitButton" data-bind="click: commit, visible: !inRebase(), enable: !commitValidationError()">
					Commit
					<!-- ko if: committingProgressBar.running -->
					<!-- ko template: { name: 'progressBar', data: committingProgressBar } --><!-- /ko -->
					<!-- /ko -->
				</button>
				<button class="rebaseContinueButton" data-bind="click: rebaseContinue, visible: inRebase, enable: !commitValidationError()">
					Continue rebase
					<!-- ko if: rebaseContinueProgressBar.running -->
					<!-- ko template: { name: 'progressBar', data: rebaseContinueProgressBar } --><!-- /ko -->
					<!-- /ko -->
				</button>
				<button class="rebaseAbortButton" data-bind="click: rebaseAbort, visible: inRebase">
					Abort rebase
					<!-- ko if: rebaseAbortProgressBar.running -->
					<!-- ko template: { name: 'progressBar', data: rebaseAbortProgressBar } --><!-- /ko -->
					<!-- /ko -->
				</button>
				<span class="amend" data-bind="visible: !inRebase()">
					<div class="checkbox" data-bind="click: toogleAmend, css: { checked: amend }"></div>
					Amend last commit
				</span>
				<span class="validationError" data-bind="text: commitValidationError, visible: commitValidationError"></span>
			</td><td class="diffArea" data-bind="css: { noFileSelected: !selectedDiffFile() }">
				<!-- ko if: selectedDiffFile -->
					<div data-bind="template: { name: 'fileDiff', data: selectedDiffFile().diffs }"></div>
				<!-- /ko -->
				<!-- ko if: !selectedDiffFile() -->
				Click a file to show its changes
				<!-- /ko -->
			</td></tr></table>
		</div>
	</div>
</script>

<script type="text/html" id="fileDiff">
	<table class="fileDiff" data-bind="foreach: $data">
		<tr data-bind="css: { added: added, removed: removed }">
			<td class="lineNumbers old">
				<span class="lineNumber" data-bind="text: oldLineNumber"></span>&nbsp;
			</td>
			<td class="lineNumbers new">
				<span class="lineNumber" data-bind="text: newLineNumber"></span>&nbsp;
			</td>
			<td class="diffs">
				<span class="diff" data-bind="text: text, css: { added: added, removed: removed }"></span>&nbsp;
			</td>
		</tr>
	</table>
</script>

<script type="text/html" id="repository">
	<div class="repository">

		<div class='animated fadeInLeft' data-bind="visible: status() == 'loading'">
			Loading...
		</div>
		
		<div class="inited animated fadeInLeft" data-bind="visible: status() == 'inited'">

			<!-- ko if: gerritIntegration -->
			<div data-bind="template: { name: 'gerritIntegration', data: gerritIntegration }"></div>
			<!-- /ko -->

			<div class="repositoryMain">

				<!-- ko template: { name: 'staging', data: staging } --><!-- /ko -->

				<!-- ko if: staging.inRebase -->
				<div class="rebasing">Rebase in progress</div>
				<!-- /ko -->

				<!-- ko if: showLog -->

				<div class="graphUtils" data-bind="visible: isFetching">
					<img src="images/grayArrowDown.png" class="arrowDown">
					<div class="fetchingIndicator">Fetching nodes from remote...</div>
				</div>

				<!-- ko if: remoteErrorPopup -->
				<div class="remoteErrorPopup animated bounceInDown">
					<span data-bind="text: remoteErrorPopup"></span>
					<a href="#" data-bind="click: closeRemoteErrorPopup">x</a>
				</div>
				<!-- /ko -->
				
				<!-- ko with: graph -->
				<div class="graph" data-bind="scrolledToEnd: scrolledToEnd">

					<div class="daySeparators" data-bind="foreach: daySeparators">
						<div class="daySeparator" data-bind="style: { left: x + 'px', top: y + 'px' }">
							<img src="images/whiteArrowRight.png" class="arrowRight">
							<div class="dateLabel" data-bind="text: date"></div>
						</div>
					</div>

					<div class="graphLog" data-bind="graphLog: $data">
					</div>
					
					<div class="nodes" data-bind="foreach: nodes">
						<div class="node" data-bind="style: { left: boxDisplayX() + 'px', top: boxDisplayY() + 'px' }">
							<div class="log" data-bind="visible: logBoxVisible">
								<div class="logEntryBox">
									<div class="arrowContainer arrowRight">
										<img src="images/whiteArrowRight.png" class="arrow">
									</div>
									<div class="title" data-bind="text: title"></div>
									<div class="date" data-bind="text: authorDate"></div>
									<a class="author" data-bind="text: authorName, attr: { href: 'mailto:' + authorEmail }"></a>
								</div>
							</div>

							<div class="refs" data-bind="style: { left: refsX() + 'px' }">
								<!-- ko foreach: branches -->
								<div class="refbox branch" data-bind="css: { current: current, remote: isRemoteBranch }, dragStart: dragStart, dragEnd: dragEnd" draggable="true">
									<img src="images/remoteIcon.png" data-bind="visible: isRemoteBranch">
									<img src="images/branchIcon.png">
									<div class="name" data-bind="text: displayName"></div>
								</div>
								<!-- /ko -->

								<!-- ko foreach: tags -->
								<div class="refbox tag" data-bind="css: { current: current, remote: isRemoteTag }, dragStart: dragStart, dragEnd: dragEnd" draggable="true">
									<img src="images/remoteIcon.png" data-bind="visible: isRemote">
									<img src="images/tagIcon.png">
									<div class="name" data-bind="text: displayName"></div>
								</div>
								<!-- /ko -->

								<!-- ko foreach: dropareaGraphActions -->
								<div class="refbox droparea" data-bind="css: style, visible: visible">
									<span data-bind="text: text"></span>
									<div class="dropmask" data-bind="dropOver: visible, drop: doPerform, dragEnter: dragEnter, dragLeave: dragLeave"></div>
									<!-- ko if: performProgressBar.running -->
									<!-- ko template: { name: 'progressBar', data: performProgressBar } --><!-- /ko -->
									<!-- /ko -->
								</div>
								<!-- /ko -->

								<div class="refbox newRef" data-bind="css: { editing: branchingFormVisible }">
									<button class="showBranchingForm" data-bind="click: showBranchingForm, visible: !branchingFormVisible()">&#x271A;</button>
									<!-- ko if: branchingFormVisible -->
									<form data-bind="submit: createBranch">
										<input class="name" type="text" autofocus="true" data-bind="value: newBranchName, hasfocus: newBranchNameHasFocus">
										<input class="submit primaryAction" type="submit" value="Branch">
										<button class="submit" data-bind="click: createTag">Tag</button>
									</form>
									<!-- /ko -->
								</div>
							</div>

						</div>
					</div>

					<div class="graphFooter">
						<!-- ko if: isLoading -->
						<!-- ko template: { name: 'progressBar', data: nodesLoader } --><!-- /ko -->
						<!-- /ko -->
					</div>

				</div>
				<!-- /ko -->

				<!-- /ko -->

			</div>

		</div>

	</div>
</script>

<script type="text/html" id="progressBar">
	<div class="progressBar" data-bind="visible: show, style: style">
		<!--span data-bind="text: predictionMs"></span-->
		<div class="progress" data-bind="style: { width: (progress() * 100) + '%' }"></div>
	</div>
</script>

<script type="text/html" id="gerritIntegration">
	<div class="gerritIntegration">
		<h1>Gerrit</h1>

		<button data-bind="visible: showInitCommmitHook, click: initCommitHook">
			Init commit hook
			<!-- ko if: initGerritHookProgressBar.running -->
			<!-- ko template: { name: 'progressBar', data: initGerritHookProgressBar } --><!-- /ko -->
			<!-- /ko -->
		</button>

		<div>
			<button data-bind="click: pushForReview">
				Push changes for review
				<!-- ko if: pushingProgressBar.running -->
				<!-- ko template: { name: 'progressBar', data: pushingProgressBar } --><!-- /ko -->
				<!-- /ko -->
			</button>
		</div>

		<div class="changes">
			<!-- ko if: status() == 'loading' -->
			<div class="loading">
			<!-- ko template: { name: 'progressBar', data: changesLoader } --><!-- /ko -->
			</div>
			<!-- /ko -->
			<div data-bind="visible: status() == 'failed'">Failed to load changes</div>
			<div data-bind="visible: status() == 'loaded'" class="animated fadeInLeft">
				<div data-bind="foreach: changes">
					<div class="change">
						<span class="subject" data-bind="text: subject"></span> by <span class="owner" data-bind="text: ownerName"></span>
						<div>
							<button class="checkout" data-bind="click: checkout">
								Checkout
								<!-- ko if: checkingOutProgressBar.running -->
								<!-- ko template: { name: 'progressBar', data: checkingOutProgressBar } --><!-- /ko -->
								<!-- /ko -->
							</button>
							<button class="openInGerrit" data-bind="click: openInGerrit">Open in gerrit</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>

<script type="text/html" id="credentialsDialog">
	<div class="credentialsDialog">
		<div>
			<form data-bind="submit: close">
			<div>Remote requires authentication</div>
			<div>Username: <input type="text" data-bind="value: username" autofocus></div>
			<div>Password: <input type="password" data-bind="value: password"></div>
			<div><input type="submit" value="Submit"></div>
			</form>
		</div>
	</div>
</script>

<script type="text/html" id="main">
	<div class="main">

		<div class="newversion" data-bind="visible: newVersionAvailable">
			A new version of ungit (<span data-bind="text: latestVersion"></span>) is available! Run 'npm update -g ungit' to install. (You are currently running version <span data-bind="text: currentVersion"></span>.)
		</div>
		
		<div class="header">

			<a class="logo" href="/#/"><img src="images/logo.png" class="logo"></a>

			<form class="currentDirectory" data-bind="submit: submitPath">
				<input type="text" data-bind="value: path">
			</form>
			
			<img src="images/repositoryBackgroundArrowUp.png" class="arrowUp">
		</div>

		<div class="content" data-bind="template: { name: templateChooser, data: content }"></div>

	</div>

	<!-- ko if: dialog -->
	<div class="dialog animated fadeIn">
		<div class="modalContainer">
			<div class="modal" data-bind="template: { name: templateChooser, data: dialog }"></div>
		</div>
	</div>
	<!-- /ko -->
</script>

<div class="app" data-bind="template: { name: templateChooser, data: content }">
</div>

<script type="text/javascript">ungit = {}</script>
<script type="text/javascript" src="/config.js"></script>
<script type="text/javascript" src="/version.js"></script>
<script type="text/javascript" src="/scripts/lib/bugsense.js"></script>
<script type="text/javascript">
	console.log('App version: ' + ungit.version);
	if (ungit.config.bugtracking) {
		console.log('Initing bugtracking');
    	var bugsense = new Bugsense( { apiKey: '3c48046e', appversion: ungit.version } );

		window.onerror = function(err) {
		    bugsense.onerror.apply(window.bugsense, arguments);
		};
    }
</script>
<script type="text/javascript" src="/scripts/lib/less-1.3.3.min.js"></script>
<script type='text/javascript' src='/scripts/lib/knockout-2.2.1.js'></script>
<script type="text/javascript" src="/scripts/lib/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="/scripts/lib/jquery.dnd_page_scroll.js"></script>
<script type="text/javascript" src="/scripts/lib/google.ui.fastbutton.js"></script>
<script type="text/javascript" src="/scripts/lib/superagent.js"></script>
<script type="text/javascript" src="/scripts/lib/signals.js"></script>
<script type="text/javascript" src="/scripts/lib/hasher.js"></script>
<script type="text/javascript" src="/scripts/lib/crossroads.js"></script>
<script type="text/javascript" src="/scripts/lib/uuid.js"></script>
<script type="text/javascript" src="/scripts/lib/moment.js"></script>
<script type="text/javascript" src="/scripts/lib/underscore.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type='text/javascript' src='/scripts/utils.js'></script>
<script type='text/javascript' src='/scripts/api.js'></script>
<script type='text/javascript' src='/scripts/git-graph-actions.js'></script>
<script type='text/javascript' src='/scripts/git-graph.js'></script>
<script type='text/javascript' src='/scripts/vector2.js'></script>
<script type='text/javascript' src='/scripts/logrenderer.js'></script>
<script type='text/javascript' src='/scripts/gerrit.js'></script>
<script type='text/javascript' src='/scripts/repository.js'></script>
<script type='text/javascript' src='/scripts/controls.js'></script>
<script type='text/javascript' src='/scripts/app.js'></script>
<script type='text/javascript' src='/scripts/main.js'></script>
<script>
	if (ungit.config.googleAnalytics) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-42045410-1', { 'cookieDomain': 'none' });
		ga('send', 'pageview');
		console.log('Google analytics inited');
	}
</script>

</body>
</html>
